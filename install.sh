#!/usr/bin/env -S bash -euo pipefail
# -------------------------------------------------------------------------------------------------------------------- #
#
# -------------------------------------------------------------------------------------------------------------------- #
# @package    Bash
# @author     Kai Kimera <mail@kai.kim>
# @license    MIT
# @version    0.1.0
# @link
# -------------------------------------------------------------------------------------------------------------------- #

(( EUID != 0 )) && { echo >&2 'This script should be run as root!'; exit 1; }

# -------------------------------------------------------------------------------------------------------------------- #
# CONFIGURATION
# -------------------------------------------------------------------------------------------------------------------- #

# Parameters.
DIR="${1:?}"; readonly DIR
NAME="${2:?}"; readonly NAME
URL="https://github.com/pkgstore/${NAME}/archive/refs/heads/main.tar.gz"; readonly URL

# -------------------------------------------------------------------------------------------------------------------- #
# -----------------------------------------------------< SCRIPT >----------------------------------------------------- #
# -------------------------------------------------------------------------------------------------------------------- #

function download() {
  curl -fLo "${NAME}-main.tar.gz" "${URL}"
}

function unpack() {
  tar -xzf "${NAME}-main.tar.gz" && { cd "${NAME}-main" || exit; }
}

function install_app() {
  for i in app_*; do install -m '0755' -Dt "${DIR}" "${i}"; done;
}

function install_cron() {
  for i in cron_*; do install -m '0644' -Dt '/etc/cron.d' "${i}"; done;
}

function main() {
  download && unpack && install_app && install_cron
}; main "$@"
